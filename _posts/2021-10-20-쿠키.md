# **우연찮은 발견**

![javasciprt](https://img.shields.io/badge/javascript-up%20to%20date-yellow)

![typescript](https://img.shields.io/badge/typescript-up%20to%20date-blue)

---

쿠키에 관해서 공부를 하던 도중, 서드파티 쿠키(third party cookie) 에 대한 내용을 보고 재미있어서 정리한다

> third party cookie란, 예를들어 우리가 웹사이트에 접속을 할 때 해당 홈페이지의 베너같은 곳의 이미지가 다른 서버에 저장되어서 호출되어 가져와진다고 가정하자
>
> 일반적으로 img 태그와 같은 임베딩 태그의 get 요청은 통상 cross origin이어도 허용이 되기 때문에 서버요청이 전달되고,
>
> 해당 서버에는 요청이 들어오면 response header에 set-cookie 헤더를 설정하여 브라우저에게 이 내용을 너의 쿠키 저장소에 저장하렴, 하고 명렁을 내린다

> 자 그러면, 우리의 브라우저는 응답의 헤더를 보고 아 이 도메인 주소에 대한 정보 객체에의 쿠키 프로퍼티에는 이러이러한 내용을 저장해야 하는구나 하고 설정해놓고 있는다.

> 이렇게, origin이 다른데도 다른 origin에 의하여 붙여지는 쿠키를 third party 쿠키라고 한다.

이 쿠키의 재미있는점은, 이용자가 어느 홈페이지로 이동하는지를 추적할 수 있다는 점이다.

예를들어, 특정 사이트에서 image 태그로 다른 서버에 이 이미지에 대한 get 요청을 날리게 해놨고, 그 요청마다 set-cookie 헤더를 통해 쿠키를 설정하도록 해놓았다고 하자.

그러면 브라우저환경에는 이 서드파트 쿠키에 대한 정보가 해당 특정 사이트의 정보객체 안에 저장된다.

그리고 나서 다시금 해당 사이트에 접속할 때에는 image 태그로 인한 요청을 할 때에 유저의 브라우저에 있는 쿠키 정보가 함께 전달될 것이므로, 이 쿠키를 통해 해당 브라우저를 특정할 수 있다.

그런데 만약 다른 사이트를 들어갔는데 해당 image태그와 똑같은 태그가 존재하고 똑같은 서버에 또 요청하고 있는 상황이라면

이 배너로 인해 이미지를 관리하는 서버는 또다시 쿠키를 받게 된다. 왜냐하면, 해당 이미지 태그의 도메인 주소의 정보객체에는 이미 서버에 요청을 보낼 때 브라우저에 설정되어 있는 서드파트 쿠키에 대한 정보가 존재하기 때문이다. 틀릴 수도 있지만 나는 이것을 이렇게 이해하였다

```
<image src="https://abs.com">
이 src로 인해 접속을 하면, 브라우저의 내부에선 저 도메인 주소에 대한 정보객체로

https://abs.com
{
  cookie {id : 12345, config?:{.....}}
}

와 같은 정보가 저장되어 있고, 쿠키의 옵션에 따라 해당 도메인으로 접속을 하려고 하면 해당 정보객체가 전달이 되는 것이다.

따라서, 타 사이트의 origin에 존재하는 동일한 src의 image 태그가 있다면, 이미 브라우저에 저장되어 있는 해당 도메인의 객체정보가 같이 전달되므로 서버는 이 유저가 어느 사이트로 이동하는지를 추적할 수 있는 것이다,.
```

즉, 서드파티 쿠키가 존재하면 사용자를 추적할 수 있다는 점인데,

유럽연합에는 GDPR이라는 법령이 있어서 이렇게 서드파티 쿠키를 이용해 추적하려고 한다면 사용자에게 명시적으로 동의를 받아야 한다는 요건이 존재한다.

가끔 해외 사이트에 가면 느닷없이 밑에서 튀어나와서 쿠키관련 동의하라고 강요하는 창이 바로 그것이었다.
